@model Gygl.BLL.Magazine.ViewModels.GyglViewModel
@{
    Layout = "~/Views/Shared/_Layout2.cshtml";
    ViewBag.Title = "期刊阅读";
}

@section scripts{
    @Scripts.Render("~/bundles/catalog")
}
@section hscripts{
    @Scripts.Render("~/bundles/angular")
}
<div id="q_top004">
    <div id="m_top004">
        <div id="top004">
            <div><img src="/Content/images/readonline.gif" width="184" height="38" /></div>
            <div class="readqishu">@Model.Year 年第&nbsp;<span class="readqishu02">@Model.Period</span>&nbsp; 期（总第 @Model.TotalPeriod 期）</div>
            <div class="readlsbq">
                <div class="readlsh"><a href="#">理事会</a></div>
                <div class="readbqy"><a href="#">版权页</a></div>
            </div>
        </div>
    </div>
</div>
@Html.Action("Catalog", "Magazine", new { id = Model.ID })
<div id="q_top05">
    <div id="m_top05">
        <div id="top05">
            <div class="top05_01">
                <div ng-repeat="page in pages">
                    <img ng-src="~/Content/Upload/Magazine/Page/{{page.url}}" />
                </div>
            </div>
            @Html.Action("RightNav", "Magazine")
        </div>
    </div>
</div>
<script>
    var app = angular.module("GyglApp", []);
    app.controller("pageCtrl", function ($scope, $http, PositionService) {
        $http.get('@Url.Action("GetFirstPages",new { pid=Model.ID})')
        .success(function (data) {
            $scope.pages = data;
            $scope.up = PositionService.upindex(0);
            $scope.down = PositionService.downindex(0);
        });
        var currentaid=0;
        $scope.click = function (aid) {
            if (currentaid != aid)
            {
                $http({
                    method: 'GET',
                    url: '@Url.Action("GetPages")',
                    params: {
                        "aid": aid
                    }
                }).success(function (data) {
                    $scope.pages = data;
                    $(document).scrollTop(0);
                    $scope.up = PositionService.upaid(aid);
                    $scope.down = PositionService.downaid(aid);
                });
                currentaid = aid;
            }
        }
    });

    app.service('PositionService', function ($http) {
        var articlelist = [];
        $http.get('@Url.Action("GetArticleList", new { pid=Model.ID})')
        .success(function (data) {
            articlelist = eval(data);
        });
        this.upindex = function (index) {
            if (index > 0)
                return articlelist[index - 1];
            else
                return articlelist[0];
        }
        this.downindex = function (index) {
            if (index = articlelist.length - 1)
                return articlelist[index];
            else
                return articlelist[index + 1];
        }

        this.upaid = function (aid) {
            var p = articlelist.indexOf(aid);
            if (p > 0) {
                return articlelist[p - 1];
            }
            else {
                return articlelist[0];
            }
        }
        this.downaid = function (aid) {
            var p = articlelist.indexOf(aid);
            if (p = articlelist.length - 1) {
                return articlelist[p];
            }
            else {
                return articlelist[p + 1];
            }
        }
    })
</script>